{% extends 'api/main.html' %}

{% block header_message %}
	<h1><a>Communication Manager - Posts List</a></h1>
{% endblock %}

{% block content %}
  <div id='sampleArea'>
  </div>
	{% for post in posts %}
	    <div class="post">
	        <h1><a href="">{{ post.title }}</a></h1>
	        <p>{{ post.text|linebreaksbr }}</p>
	        <div class="date">
	            <p>published: {{ post.published_date }}</p>
	        </div>
	    </div>
	{% endfor %}
{% endblock %}

{% block scripts %}
  <script id="personTpl" type="text/template">
    {% templatetag openvariable %} #names {% templatetag closevariable %}
      <b>{% templatetag openvariable %} name {% templatetag closevariable %}</b>
    {% templatetag openvariable %} /names {% templatetag closevariable %}
  </script>
  <script>
    var data = {names: [{name: 'Shayan'}, {name: 'Awesome'}, {name: 'Captain'}]}
    var template = $('#personTpl').html();
    var html = Mustache.to_html(template, data);
    $('#sampleArea').html(html);
  </script>

  <script>
  page_id = {{page_id}};

  // This is called with the results from from FB.getLoginStatus().
  function statusChangeCallback(response) {
    if (response.status !== 'connected') {
      // Logged into your app and Facebook.
	  window.location.replace('/login');
    }

    getPagePosts();
  }

  function showPagePosts(pagePosts) {
    if (pagePosts.length > 0) {
      // TODO: Add the posts to the main view
      pagePosts.forEach(function(post) {
        console.log(post);
        // console.log(post.id);
        // console.log(post.likes);
        // console.log(post.link);
      });
    } else {
      // TODO: Have a placeholder, with a message, no posts in page.
      console.log("No posts in this Page.");
    }
  }

  function getPagePosts() {
    // TODO: do a check for the integrity of page_id
    endpoint = page_id.toString() + '/feed';
    FB.api(endpoint, {fields: 'message,id,likes,link'}, function(response) {
      // TODO: check response object has data field
      showPagePosts(response.data);
    })
  }
  // This function is called when someone finishes with the Login
  // Button.  See the onlogin handler attached to it in the sample
  // code below.
  function checkLoginState() {
    FB.getLoginStatus(function(response) {
      console.log(response.status);
      statusChangeCallback(response);
    });
  }
</script>
{% endblock %}
