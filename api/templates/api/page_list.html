{% extends 'api/main.html' %}

{% block header_message %}
	<h1><a>Communication Manager - Page List</a></h1>
{% endblock %}

{% block content %}
<div class='nav'>
  <a class='home selected' onclick="goHome();">
  </a>
  <a class='posts'>
  </a>
</div>

<div class='content'>
  <div class='h'>
    <div class="post_composer">
      <div class="post_body">
        <div class="post_author">
          <div id="admin_picture"></div>
        </div>
        <div class="post_compose">
          <div class="speech_arrow">
            <div></div>
            <div></div>
          </div>
          <textarea type="text" placeholder="Compose a post..."></textarea>
        </div>
      </div>
      <div class="post_buttons">
        <div class="button">Post</div>
      </div>
    </div>
    <div id="feedColumn" class="feed">
    </div>
  </div>
</div>

{% endblock %}

{% block scripts %}
	<script>
  // TODO: On click -> window.location.replace('/post_list/<page-id>')
  // This is called with the results from from FB.getLoginStatus().
  function statusChangeCallback(response) {
    if (response.status !== 'connected') {
      // Logged into your app and Facebook.
      window.location.replace("/login");
    }

    userId = response.authResponse.userID;

  }

  function showManagedPages(pages) {
    if (pages.length > 0) {
      // TODO: Add the pages to the main view
      pages.forEach(function(page) {
        console.log(page.access_token);
        console.log(page.category);
        console.log(page.name);
        console.log(page.id);
      });
    } else {
      // TODO: Write a message, no pages under management by user.
      console.log("No pages under management by this user.");
    }
  }

  function getManagedPages(userId) {
    // TODO: String formatting in Javascript
    apiEndpoint = userId.toString() + '/accounts';

    FB.api(apiEndpoint, function(response) {
      // TODO: Check edge cases, does response have data field?
      // handle 500 errors.
      showManagedPages(response.data);
    });
  }

  // This function is called when someone finishes with the Login
  // Button.  See the onlogin handler attached to it in the sample
  // code below.
  function checkLoginState() {
    FB.getLoginStatus(function(response) {
      console.log(response.status);
      statusChangeCallback(response);
    });
  }
</script>
{% endblock %}
